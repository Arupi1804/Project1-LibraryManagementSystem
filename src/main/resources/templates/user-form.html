<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tạo tài khoản mới - Hệ thống quản lý thư viện</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <!-- Include Navbar -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <div class="main-layout">
        <!-- Include Sidebar -->
        <div th:replace="~{fragments/sidebar :: sidebar}"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <h2>Tạo tài khoản mới</h2>
            </div>

            <!-- Error Messages -->
            <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

            <!-- Create User Form -->
            <div class="form-container">
                <form th:action="@{/users}" method="post" class="form">
                    <div class="form-group">
                        <label for="username">Username *</label>
                        <input type="text" id="username" name="username" required minlength="3" maxlength="50"
                            class="form-control-sm" placeholder="Nhập username (ít nhất 3 ký tự)"
                            pattern="[a-zA-Z0-9_]+" title="Chỉ chấp nhận chữ cái, số và dấu gạch dưới">
                        <small>Username dùng để đăng nhập, chỉ chứa chữ cái, số và dấu gạch dưới</small>
                    </div>

                    <div class="form-group">
                        <label for="password">Password *</label>
                        <input type="password" id="password" name="password" required minlength="6"
                            class="form-control-sm" placeholder="Nhập password (ít nhất 6 ký tự)">
                        <div style="margin-top: 5px;">
                            <label style="font-weight: normal; font-size: 13px;">
                                <input type="checkbox" id="showPassword" onclick="togglePassword()">
                                Hiển thị password
                            </label>
                        </div>
                        <small>Password phải có ít nhất 6 ký tự</small>
                    </div>

                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" name="email" required maxlength="100" class="form-control-sm"
                            placeholder="Nhập email">
                        <small>Email phải hợp lệ và duy nhất trong hệ thống</small>
                    </div>

                    <div class="form-group">
                        <label for="role">Vai trò *</label>
                        <select id="role" name="role" required class="form-control-sm">
                            <option value="">-- Chọn vai trò --</option>
                            <option value="ROLE_ADMIN">Admin - Quản trị viên hệ thống</option>
                            <option value="ROLE_LIBRARIAN">Librarian - Thủ thư</option>
                        </select>
                        <small>
                            <p><strong>Admin:</strong> Toàn quyền quản lý hệ thống</p>
                            <p><strong>Librarian:</strong> Quản lý sách, độc giả, mượn/trả</p>
                        </small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Tạo tài khoản</button>
                        <a th:href="@{/users}" class="btn btn-secondary">Hủy</a>
                    </div>
                </form>
            </div>

            <!-- Info Box -->
            <div class="alert alert-info" style="margin-top: 20px;">
                <strong>Lưu ý:</strong>
                <ul style="margin: 10px 0 0 20px;">
                    <li>Username và Email phải là duy nhất trong hệ thống</li>
                    <li>Password sẽ được mã hóa tự động khi lưu</li>
                    <li>Tài khoản mới được tạo sẽ ở trạng thái "Hoạt động" mặc định</li>
                    <li>Admin có thể khoá/mở khoá tài khoản sau khi tạo</li>
                </ul>
            </div>
        </main>
    </div>

    <script>
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const checkbox = document.getElementById('showPassword');

            if (checkbox.checked) {
                passwordInput.type = 'text';
            } else {
                passwordInput.type = 'password';
            }
        }
    </script>
</body>

</html>